<meta http-equiv="content-type" content="text/html" charset=utf-8" />
<script type="text/javascript" src="jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="draw_component.js"></script>
<script type="text/javascript" >
jQuery(document).ready(function(){






var draw_section_text = 
'DEF EL84 U 0 0 Y Y 2 L N'+'\r\n'+
'F0 "U" 100 400 50 H V C C'+'\r\n'+ 
'F1 "EL84" 300 -300 50 H V C C'+'\r\n'+ 
'P 2 1 1 0  -170 -130  -170 147 N'+'\r\n'+ 
'P 2 1 1 8  -75 -50  -125 -50 N'+'\r\n'+
'P 2 1 1 8  -150 150  -110 150 N'+'\r\n'+ 
'P 3 2 1 0  100 -250  100 -200  100 -200 N'+'\r\n'+ 
'P 3 0 1 0  200 -100  200 150  200 150 N'+'\r\n'+ 
'P 3 2 1 0  -100 -200  -100 -250  -100 -250 N'+'\r\n'+ 
"P 2 1 1 8  150 150  110 150 N"+'\r\n'+ 
"P 2 1 1 8  -73 150 -48 150 N"+'\r\n'+ 
"P 2 1 1 8  -13 150 13 150 N"+'\r\n'+
"A 0 -225 103 142 1659 1 1 10 N 100 -200 -100 -200"+'\r\n'+ 
"P 2 1 1 8  -25 -50  25 -50 N"+'\r\n'+ 
"A 0 150 200 1 1799 0 1 0 N 200 150 -200 150"+'\r\n'+ 
"P 2 1 1 8  -23 50  3 50 N"+'\r\n'+ 
"P 3 1 1 10  -100 250  100 250  100 250 N"+'\r\n'+ 
"P 2 1 1 0  -200 -50  -125 -50 N"+'\r\n'+ 
"P 2 1 1 8  38 50  63 50 N"+'\r\n'+ 
"P 2 1 1 0  -160 147  -170 147 N"+'\r\n'+ 
"P 2 1 1 8  100 50  125 50 N"+'\r\n'+ 
"A 0 -300 141 450 1350 2 1 0 N 100 -200 -100 -200"+'\r\n'+  
"P 2 1 1 0  0 250  0 350 N"+'\r\n'+ 
"P 2 1 1 8  48 150  73 150 N"+'\r\n'+ 
"P 2 1 1 8  175 100  125 50 N"+'\r\n'+ 
"P 2 1 1 8  -150 200  -150 150 N"+'\r\n'+ 
"A 0 -100 200 -1799 -1 0 1 0 N -200 -100 200 -100"+'\r\n'+   
"P 2 1 1 8  -135 100  -85 50 N"+'\r\n'+ 
"P 2 1 0 0  -100 -200  -100 -300 N"+'\r\n'+
"P 2 1 1 8  75 -50  125 -50 N"+'\r\n'+ 
"P 2 1 1 0  -170 -130  -100 -190 N"+'\r\n'+ 
"P 3 0 1 0  -200 150  -200 -100  -200 -100 N"+'\r\n'+ 
"P 2 1 1 8  150 200  150 150 N"+'\r\n'+ 
"P 2 1 1 0  125 50  200 50 N"+'\r\n'+ 
"P 2 1 1 8  -85 50  -58 50 N"+'\r\n'+ 
"X A 7 0 450 100 D 40 40 1 1 O"+'\r\n'+
"X G2 9 300 50 100 L 40 40 1 1 I"+'\r\n'+
"X G1 2 -300 -50 100 R 40 40 1 1 I"+'\r\n'+
"X F1 4 -100 -400 150 U 40 40 2 1 W"+'\r\n'+
"X K_G3 3 -100 -350 100 U 40 40 1 1 B"+'\r\n'+
"X F2 5 100 -400 150 U 40 40 2 1 W";


/*
var draw_section_text = 
'P 4 1 1 0  450 -250  300 -500  500 -500  500 -400 F'+'\r\n'+ 
'P 7 1 1 0  -500 350  -600 200  -500 50  -350 50  -250 200  -350 350  -500 350 N'+'\r\n'+ 
'P 4 1 1 0  -550 -300  -700 -500  -200 -500  -350 -300 f'+'\r\n'+
'P 14 1 1 0  150 100  50 200  150 200  150 250  50 350  100 400  200 300  250 300  250 350  250 400  350 300  350 200  250 100  150 100 N';
*/

/*
var draw_section_text = 
'C -500 -500 250 0 1 0 f'+'\r\n'+
'C -500 500 250 0 1 0 N'+'\r\n'+ 
'C 500 -500 250 0 1 0 F'+'\r\n'+ 
'C 500 500 250 0 1 100 N';
*/

/*
var draw_section_text = 
'S -100 -100 -650 -600 0 1 0 f'+'\r\n'+
'S -100 100 -350 400 0 1 0 N'+'\r\n'+ 
'S 100 -100 500 -500 0 1 0 F'+'\r\n'+ 
'S 100 100 850 550 0 1 100 N';
*/


/*
var draw_section_text =
'A -850 200 112 1165 -1165 0 1 0 F -900 300 -900 100'+'\r\n'+
'A -750 100 112 -1534 -265 0 1 0 F -850 50 -650 50'+'\r\n'+
'A -750 300 112 1534 265 0 1 0 F -850 350 -650 350'+'\r\n'+
'A -650 200 112 634 -634 0 1 0 F -600 300 -600 100'+'\r\n'+
'A -550 -500 158 184 1615 0 1 100 f -400 -450 -700 -450'+'\r\n'+
'A -350 500 112 1534 -634 0 1 0 F -450 550 -300 400'+'\r\n'+
'A -350 650 112 634 -1534 0 1 0 F -300 750 -450 600'+'\r\n'+
'A -325 250 75 1 1799 0 1 0 N -250 250 -400 250'+'\r\n'+
'A -250 -175 75 901 -901 0 1 0 N -250 -100 -250 -250'+'\r\n'+
'A -200 500 112 -1165 265 0 1 0 F -250 400 -100 550'+'\r\n'+
'A -200 650 112 -265 1165 0 1 0 F -100 600 -250 750'+'\r\n'+
'A 201 351 69 451 -1351 0 1 0 N 250 400 150 300'+'\r\n'+
'A 450 -300 200 -1799 -1 0 1 100 N 250 -300 650 -300'+'\r\n'+
'A 500 400 100 -1799 -1 0 1 0 N 400 400 600 400';
*/

var DrawPanel = new DrawPanObj(document.getElementById("id_view"),draw_section_text);
DrawPanel.BestScale();
DrawPanel.Draw();	

// using bind
$('#id_view').bind('mousewheel', function(event, delta) {
  //  console.log(delta);
});

$(function() {
   $("body").mousewheel(function(event, delta) {

   	
    this.scrollLeft -= (delta * 30);
	event.preventDefault();
	
	DrawPanel.Clear();
	
	
	if ((event.ctrlKey)&&(!event.shiftKey))  // horizontal pan
	{
		//DrawPanel.originx += delta*10;
	}
	if ((event.shiftKey)&&(!event.ctrlKey)) // vertical pan
	{
		//DrawPanel.originy += delta*10;
	}
	if ((!event.shiftKey)&&(!event.ctrlKey)) //zoom
	{
		DrawPanel.mousex = event.clientX - DrawPanel.canvas.offsetLeft - DrawPanel.canvas.width/2;
	    //console.log("mousex="+DrawPanel.mousex);
		DrawPanel.mousey = event.clientY - DrawPanel.canvas.offsetTop - DrawPanel.canvas.height/2;
		//console.log("mousey="+DrawPanel.mousey);
		if ((delta > 0)&&(DrawPanel.iscale<16))
		{
			DrawPanel.iscale++;
			DrawPanel.zoom=1.4;
		}
		if ((delta < 0)&&(DrawPanel.iscale>0))
		{
			DrawPanel.iscale--;
			DrawPanel.zoom=1/1.4;
		}	
		/*
		if ((delta > 0)&&(DrawPanel.iscale<16))
		{
			DrawPanel.iscale++;
			DrawPanel.zoom=2;
		}
		if ((delta < 0)&&(DrawPanel.iscale>0))
		{
			DrawPanel.iscale--;
			DrawPanel.zoom=0.5;
		}	
		*/
		
		DrawPanel.context.translate( DrawPanel.originx, DrawPanel.originy);
		DrawPanel.context.scale(DrawPanel.zoom,DrawPanel.zoom);
		DrawPanel.context.translate(
			-( DrawPanel.mousex / DrawPanel.scale + DrawPanel.originx - DrawPanel.mousex / ( DrawPanel.scale * DrawPanel.zoom ) ),
			-( DrawPanel.mousey / DrawPanel.scale + DrawPanel.originy - DrawPanel.mousey / ( DrawPanel.scale * DrawPanel.zoom ) )
			
		);

		DrawPanel.originx += ( DrawPanel.mousex / DrawPanel.scale - DrawPanel.mousex / ( DrawPanel.scale * DrawPanel.zoom ) );
		DrawPanel.originy += ( DrawPanel.mousey / DrawPanel.scale - DrawPanel.mousey / ( DrawPanel.scale * DrawPanel.zoom ) );
		DrawPanel.scale *= DrawPanel.zoom;
		//console.log("scale="+DrawPanel.scale);
	
	}
		
	DrawPanel.Draw();
   
   });
});
});
</script>

<style>
canvas{
   border:1px solid black;
   /*height:600px;
   width:600px;*/
}
</style>
TEST canvas <input type="button" onclick="alert('WOW!')" value="click me!"/> <br>
<canvas width="500" height="500" id="id_view">Your browser is bad!</canvas>
